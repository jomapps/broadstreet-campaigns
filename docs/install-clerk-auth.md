# Clerk Auth Installation Guide

This guide documents the completed installation of Clerk Auth for the Broadstreet Campaigns internal tool.

## Overview

Clerk Auth provides authentication and authorization for the Broadstreet UI. It is built on Clerk, a hosted authentication platform. The installation is now complete with proper route protection and a public home page.

## Completed Steps

### 1. Install Clerk Auth - ✅ DONE
```bash
pnpm install @clerk/nextjs
```

### 2. Environment Configuration - ✅ DONE
Environment variables are configured in `.env.local`:
```
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_dmlhYmxlLW1hcm1vc2V0LTU5LmNsZXJrLmFjY291bnRzLmRldiQ
CLERK_SECRET_KEY=sk_test_wmWJZCkytFH2dFy5jbu2rBJlYmyWR7wVc49Gj2doRi
```

### 3. Middleware Configuration - ✅ DONE
Updated `src/middleware.ts` to protect all routes except the home page:
- Protected routes: `/dashboard`, `/networks`, `/advertisers`, `/advertisements`, `/zones`, `/campaigns`, `/placements`, `/themes`, `/local-only`, `/api`
- Public routes: `/` (home page)

### 4. Layout Integration - ✅ DONE
Updated `src/app/layout.tsx` to include:
```
import { type Metadata } from 'next'
import {
  ClerkProvider,
  SignInButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/nextjs'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Clerk Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          <header className="flex justify-end items-center p-4 gap-4 h-16">
            <SignedOut>
              <SignInButton />
              <SignUpButton>
                <button className="bg-[#6c47ff] text-ceramic-white rounded-full font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 cursor-pointer">
                  Sign Up
                </button>
              </SignUpButton>
            </SignedOut>
            <SignedIn>
              <UserButton />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </ClerkProvider>
  )
}
```

### 5. Home Page Design - ✅ DONE
Created a public home page (`src/app/page.tsx`) that:
- Shows "Broadstreet Campaigns - Internal Management Tool" branding
- Displays access required message
- Provides contact information: leo@fashmedien.de
- Includes Sign In button for authentication
- Automatically redirects authenticated users to `/dashboard`

### 6. Authentication Layout - ✅ DONE
Created `AuthenticatedLayout` component that:
- Shows full dashboard layout (Header, Sidebar, etc.) for authenticated users
- Shows only page content for public pages
- Integrates with existing QueryProvider and AppInitializer

### 7. Header Integration - ✅ DONE
Updated Header component to include:
- UserButton for authenticated users
- Proper styling and positioning

## Architecture

### Route Protection
- **Public Routes**: `/` (home page only)
- **Protected Routes**: All other routes require authentication
- **Automatic Redirects**: Authenticated users on home page → `/dashboard`

### Layout Structure
```
ClerkProvider
└── AuthenticatedLayout
    ├── SignedIn: Full dashboard layout (Header, Sidebar, QueryProvider, etc.)
    └── SignedOut: Direct content rendering (for public pages)
```

### User Experience
1. **Unauthenticated users**: See branded home page with sign-in option
2. **Authenticated users**: Automatically redirected to dashboard with full UI
3. **Access requests**: Directed to contact leo@fashmedien.de

## Testing
The installation is complete and ready for testing:
```bash
pnpm dev
```
Visit `http://localhost:3005` to see the public home page.

## Status: ✅ COMPLETE
All Clerk authentication setup is now complete and functional.